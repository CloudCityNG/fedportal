{"version":3,"sources":["grade-student.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","id","loaded","call","m","c","p","$modal","$","$modalBody","$studentQueryForm","click","show","tenMostRecentSemesters","JSON","parse","text","autocomplete","sessionSemesterAutoComplete","formValidation","fields","student-course-query[semester_id]","excluded","validators","notEmpty","message","resetExisting","$el","existingVal","data","val","updateRowWithLetterGrade","prop","siblings","hide","trim","scoreGrade","scoreToLetterGrade","score","grade","parent","next","Number","isNaN","_","find","scoreGradeMapping","minMax","min","max","toFixed","getFreshAndUpdatedGrades","newScore","oldScore","updated","grades","$courseScores","each","this","is","push","closest","clone","buildValidForm","$tdExistingScore","$scoreInputTd","$scoreInput","$children","$scoreInputValidForm","html","$tBody","$tr","index","children","first","filter","attr","remove","append","$table","lenGrades","length","coursesPluralize","studentRegNo","get","outerHTML","invalidFormMsg","$input","$form","resetField","row","selector","on","e","element","evt","preventDefault","modal","resetForm","source","fieldToDisplay","minLength","select","ui","$related","item","originalEvent","which","window","setTimeout"],"mappings":"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","file":"grade-student.min.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n\n\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/*jshint camelcase:false*/\n\n\t\"use strict\";\n\n\tvar $modal = $('#current-semester-form-modal')\n\tvar $modalBody = $('#current-semester-form-modal-body')\n\tvar $studentQueryForm = $('#student-course-query-form')\n\n\t$('.just-graded-courses-close').click(function() {\n\t  $studentQueryForm.show()\n\t});\n\n\t(function studentCourseQueryFrom() {\n\t  var tenMostRecentSemesters = JSON.parse($('#tenMostRecentSemesters-container').text());\n\n\t  $('#semester').autocomplete(\n\t    __webpack_require__(1).sessionSemesterAutoComplete(\n\t      tenMostRecentSemesters, 'label'\n\t    )\n\t  );\n\n\t  $studentQueryForm.formValidation(\n\t    {\n\t      fields: {\n\t        'student-course-query[semester_id]': {\n\t          excluded: false,\n\t          validators: {\n\t            notEmpty: {message: 'You may only pick from the drop down list'}\n\t          }\n\t        }\n\t      }\n\t    }\n\t  );\n\t})();\n\n\t(function studentCourseScoreForm() {\n\t  var $courseScores = $('.course-score');\n\t  var invalidFormMsg = '<div class=\"modal-body-caption no-valid\">\\n' +\n\t                       '  No score was inputted or updated. You may not submit form!\\n' +\n\t                       '</div>';\n\t  var studentRegNo = $('#student-reg-number').text();\n\n\t  $('.course-score-edit-trigger').click(function() {\n\t    $(this).hide()\n\t      .siblings('.course-score').prop('disabled', false)\n\t      .siblings('.course-score-view-only-trigger').show();\n\t  });\n\n\t  $('.course-score-view-only-trigger').click(function() {\n\t    var $input = $(this).hide()\n\t      .siblings('.course-score').prop('disabled', true);\n\n\t    $form.data('formValidation').resetField($input);\n\t    resetExisting($input);\n\n\t    $input.siblings('.course-score-edit-trigger').show();\n\t  });\n\n\t  var scoreGradeMapping = JSON.parse($('#scoreGradeMapping-container').text());\n\n\t  var $form = $('#student-course-score-form').formValidation(\n\t    {\n\t      row: {\n\t        selector: 'td'\n\t      }\n\t    }\n\t  );\n\n\t  $form.on('success.field.fv', '.course-score', function(e, data) {\n\t    updateRowWithLetterGrade(data.element);\n\t  });\n\n\t  $form.on('success.form.fv', function(evt) {\n\t    evt.preventDefault();\n\t    var grades = getFreshAndUpdatedGrades();\n\n\t    if (grades.length === 0) {\n\t      $modalBody.html('');\n\t      $modalBody.html(invalidFormMsg);\n\n\t    } else {\n\t      $modalBody.html('');\n\t      $modalBody.append(buildValidForm(grades));\n\t    }\n\n\t    $modal.modal('show');\n\t    $form.data('formValidation').resetForm();\n\t  });\n\n\t  $('#student-course-score-form-reset-btn').click(function() {\n\t    $form.data('formValidation').resetForm();\n\n\t    $courseScores.each(function() {\n\t      var $el = $(this);\n\n\t      if ($el.is('.already-graded')) resetExisting($el);\n\n\t      else $el.val('').parent().siblings('.grade').text('');\n\t    });\n\t  });\n\n\t  /**\n\t   * Reset a row to score existing in the database if course for the row has been scored.\n\t   *\n\t   * @param {jQuery} $el\n\t   */\n\t  function resetExisting($el) {\n\t    var existingVal = $el.data('existing-score');\n\t    $el.val(existingVal);\n\n\t    if (existingVal) {\n\t      updateRowWithLetterGrade($el);\n\t      $el.prop('disabled', true)\n\t        .siblings('.course-score-view-only-trigger').hide()\n\t        .siblings('.course-score-edit-trigger').show();\n\t    }\n\t  }\n\n\t  /**\n\t   *\n\t   * @param {jQuery} $el\n\t   */\n\t  function updateRowWithLetterGrade($el) {\n\t    var val = $el.val().trim();\n\n\t    if (val) {\n\t      var scoreGrade = scoreToLetterGrade(val);\n\n\t      if (scoreGrade) {\n\t        var\n\t          score = scoreGrade[0],\n\t          grade = scoreGrade[1];\n\n\t        $el.val(score);\n\t        $el.parent().next().text(grade);\n\t      }\n\n\t    }\n\t  }\n\n\t  /**\n\t   *\n\t   * @param {String|number} score - student's score in course. Must be a number or numeric string\n\t   * @returns {Array|null}\n\t   */\n\t  function scoreToLetterGrade(score) {\n\t    score = Number(score);\n\n\t    if (isNaN(score)) {\n\t      return null;\n\t    }\n\n\t    var scoreGrade = _.find(scoreGradeMapping, function(minMax) {\n\t      var\n\t        min = minMax[0],\n\t        max = minMax[1];\n\n\t      return min <= score && score <= max;\n\t    });\n\n\t    score = score.toFixed(2);\n\t    return [score, scoreGrade ? scoreGrade[2] : 'F'];\n\t  }\n\n\t  function getFreshAndUpdatedGrades() {\n\t    var grades = [];\n\t    var $el, newScore, oldScore, updated;\n\n\t    $courseScores.each(function() {\n\t      $el = $(this);\n\t      newScore = $el.val().trim();\n\n\t      if ($el.is('.already-graded')) {\n\t        newScore = Number(newScore);\n\t        oldScore = Number($el.data('existing-score').trim());\n\t        updated = newScore !== oldScore;\n\n\t        if (updated) grades.push($el.closest('tr').clone());\n\n\t      } else {\n\t        if (newScore) grades.push($el.closest('tr').clone());\n\t      }\n\t    });\n\n\t    return grades;\n\t  }\n\n\t  /**\n\t   *\n\t   * @param {Object} grades\n\t   */\n\t  function buildValidForm(grades) {\n\t    var $scoreInputValidForm = $($('#scores-input-valid-form-template').html());\n\t    var $tdExistingScore, $scoreInputTd, $scoreInput, $children;\n\n\t    var $tBody = $scoreInputValidForm.find('tbody');\n\n\t    _.each(grades, function($tr, index) {\n\t      $children = $tr.children();\n\n\t      $children.first().text(index + 1);\n\n\t      $scoreInputTd = $children.filter('.fresh-score');\n\t      $scoreInput = $scoreInputTd.children('.course-score').attr('type', 'hidden');\n\t      $scoreInput.siblings().remove();\n\t      $scoreInputTd.append($scoreInput.val());\n\n\t      $tdExistingScore = $children.filter('.td-existing-score');\n\n\t      if ($tdExistingScore.is('.already-graded-td')) $tdExistingScore.text($tdExistingScore.children().val());\n\t      else $tdExistingScore.text('');\n\n\t      $tBody.append($tr);\n\t    });\n\n\t    var $table = $scoreInputValidForm.children('table').clone();\n\n\t    var lenGrades = grades.length;\n\t    var coursesPluralize = 'course' + (lenGrades > 1 ? 's' : '');\n\n\t    $table.children('caption').text(\n\t      lenGrades + ' ' + coursesPluralize + ' newly graded/updated for student registration number \"' + studentRegNo + '\"'\n\t    );\n\t    $scoreInputValidForm\n\t      .find('#student-score-table-text')\n\t      .val($table.get(0).outerHTML);\n\n\t    return $scoreInputValidForm;\n\t  }\n\t})();\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\texports.sessionSemesterAutoComplete = __webpack_require__(2)\n\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\n\t/**\n\t *\n\t * @param {Array} source\n\t * @param {String} fieldToDisplay - the field from the source that will be set as value\n\t * of form control been auto-completed\n\t *\n\t * @returns {{minLength: number, source: Array, select: Function}}\n\t */\n\tfunction sessionSemesterAutoComplete(source, fieldToDisplay) {\n\t  return {\n\t    minLength: 1,\n\n\t    source: source,\n\n\t    select: function(evt, ui) {\n\t      var\n\t        $el = $(this),\n\t        $related = $($el.data('related-input-id'));\n\n\t      $related.val(ui.item.id);\n\n\t      if (evt.originalEvent.which === 1) {\n\t        window.setTimeout(function() {\n\t                            $el.val(ui.item[fieldToDisplay]);\n\t                          }\n\t        );\n\t      }\n\n\t      window.setTimeout(function() {\n\t                          $el.closest('form').formValidation('revalidateField', $el);\n\t                          $el.closest('form').formValidation('revalidateField', $related);\n\t                        }\n\t      );\n\n\t      return false;\n\t    }\n\t  };\n\t}\n\n\tmodule.exports = sessionSemesterAutoComplete\n\n\n/***/ }\n/******/ ]);"],"sourceRoot":"/source/"}